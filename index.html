<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plane Crash Visualisation</title>
    <script src="https://cdn.jsdelivr.net/npm/vega@6"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@6"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@7"></script>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div id="vis-map"></div>
    <div id="vis-bar"></div>
    <script type="text/javascript">

        const mapSpec = {
            "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
            "width": 1500,
            "height": 800,
            "title": "Airplane Crashes from 2000 to 2025",
            "projection": {
                "type": "naturalEarth1",
            },
            "layer": [
                {
                    "data": {
                        "url": "data/ne_50m_ocean.json",
                        "format": {
                            "type": "topojson",
                            "feature": "ne_50m_ocean"
                        }
                    },
                    "mark": {
                        "type": "geoshape",
                        "fill": "#91C8E4",
                    },
                },
                {
                    "data": {
                        "url": "data/ne_110m_admin_0_countries.json",
                        "format": {
                            "type": "topojson",
                            "feature": "ne_110m_admin_0_countries"
                        }
                    },
                    "mark": {
                        "type": "geoshape",
                        "fill": "#FBF5DE",
                        "stroke": "#EAC8A6"
                    },
                },
                {
                    "data": { "graticule": { "step": [30, 30] } },
                    "mark": { "type": "geoshape", "stroke": "#DCDCDC" },
                },
                {
                    "data": {
                        "values": [
                            { "name": "Atlantic Ocean", "longitude": -35, "latitude": 15 },
                            { "name": "Pacific Ocean", "longitude": -140, "latitude": 0 },
                            { "name": "Indian Ocean", "longitude": 80, "latitude": -20 },
                            { "name": "Southern Ocean", "longitude": 0, "latitude": -65 },
                            { "name": "Arctic Ocean", "longitude": 0, "latitude": 72 }
                        ]
                    },
                    "mark": {
                        "type": "text",
                        "fontSize": 16,
                        "fontStyle": "italic",
                        "fill": "#3A59D1"
                    },
                    "encoding": {
                        "longitude": { "field": "longitude", "type": "quantitative" },
                        "latitude": { "field": "latitude", "type": "quantitative" },
                        "text": { "field": "name" }
                    }
                },
                {
                    "data": {
                        "url": "data/plane_crashes_2000_2025.csv"
                    },
                    "mark": "circle",
                    "encoding": {
                        "longitude": {
                            "field": "Longitude",
                            "type": "quantitative"
                        },
                        "latitude": {
                            "field": "Latitude",
                            "type": "quantitative"
                        },
                        "size": {
                            "bin": { "step": 50 },
                            "field": "Fatalities Total",
                            "type": "quantitative",
                            "scale": { "range": [10, 100] },
                            "legend": { "title": "Total Number of Fatalities" }
                        },
                        "color": { "value": "#DC3C22" },
                        "tooltip": [
                            { "field": "Date" },
                            { "field": "Location" },
                            { "field": "Operator" },
                            { "field": "Route" },
                            { "field": "Aboard Total" },
                            { "field": "Fatalities Total" },
                            { "field": "Ground" },
                            { "field": "Summary" },
                        ],
                    }
                }
            ]
        }

        const barSpec = {
            "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
            "width": 600,
            "height": 600,
            "title": "Top 10 Number of Crashes by Operator",
            "data": { "url": "data/plane_crashes_2000_2025.csv" },
            "params": [
                {
                    "name": "yearFilter",
                    "value": "All",
                    "bind": {
                        "input": "select",
                        "options": ["All", 2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024, 2025],
                        "name": "Select Year: "
                    }
                }
            ],

            "layer": [
                {
                    "transform": [
                        {
                            "calculate": "year(timeParse(datum.Date, '%B %d, %Y'))",
                            "as": "Year"
                        },
                        {
                            "filter": "yearFilter == 'All' || datum.Year == yearFilter"
                        },
                        {
                            "aggregate": [{
                                "op": "count",
                                "field": "Operator",
                                "as": "crash_no"
                            }],
                            "groupby": ["Operator"]
                        },
                        {
                            "window": [{ "op": "row_number", "as": "rank" }],
                            "sort": [{ "field": "crash_no", "order": "descending" }],
                        },
                        {
                            "filter": "datum.rank <= 10"
                        },
                    ],
                    "mark": {
                        "type": "bar",
                        "size": 40,
                        "color": "#F08787",
                    },
                    "encoding": {
                        "x": {
                            "field": "Operator",
                            "type": "nominal",
                            "sort": "-y",
                            "axis": { "labelAngle": 30 },
                        },
                        "y": {
                            "field": "crash_no",
                            "type": "quantitative",
                            "title": "Number of Crashes"
                        },
                        "tooltip": [
                            { "field": "Operator" },
                            { "field": "crash_no", "title": "Crashes" },
                        ]
                    }
                },
                {
                    "transform": [
                        {
                            "calculate": "year(timeParse(datum.Date, '%B %d, %Y'))",
                            "as": "Year"
                        },
                        {
                            "filter": "yearFilter == 'All' || datum.Year == yearFilter"
                        },
                        {
                            "aggregate": [
                                { "op": "count", "field": "Operator", "as": "crash_no" }
                            ],
                            "groupby": ["Operator"]
                        },
                    ],
                    "layer": [
                        {
                            "mark": {
                                "type": "rule",
                                "strokeWidth": 1,
                                "strokeDash": [8, 8],
                                "color": "#2d2d2d"
                            },
                            "encoding": {
                                "y": {
                                    "aggregate": "mean",
                                    "field": "crash_no",
                                    "type": "quantitative",
                                },
                            }
                        },
                        {
                            "mark": {
                                "type": "text",
                                "dx": 700,
                                "size": 10,
                                "color": "#2d2d2d"
                            },
                            "encoding": {
                                "x": { "value": 0 },
                                "y": {
                                    "aggregate": "mean",
                                    "field": "crash_no",
                                    "type": "quantitative",
                                },
                                "text": { "value": "Average Number of Crashes per Operator" },
                                "tooltip": [
                                    {
                                        "aggregate": "mean",
                                        "field": "crash_no",
                                        "title": "Average number of crashes per Operator"
                                    }
                                ]
                            }
                        }
                    ]

                }
            ]
        };

        vegaEmbed('#vis-map', mapSpec);
        vegaEmbed('#vis-bar', barSpec)
    </script>
</body>

</html>